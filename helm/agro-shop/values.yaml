# Default values for agro-shop

global:
  imagePullSecrets: []

app:
  name: agro-shop
  replicaCount: 1

  image:
    # default fallback (prod overrides to Docker Hub)
    repository: "mukhiddinov/agro-shop"
    tag: "latest"
    pullPolicy: Always

  service:
    type: ClusterIP
    port: 80
    targetPort: 5000
    annotations: {}

  ingress:
    enabled: true
    className: "nginx"
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
    hosts:
      - host: agro-shop.local
        paths:
          - path: /
            pathType: Prefix
    tls: []

  env:
    - name: FLASK_ENV
      value: "production"
    - name: DATABASE_URL
      value: "sqlite:////app/data/agro.db"

  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi

  livenessProbe:
    httpGet:
      path: /health
      port: 5000
    initialDelaySeconds: 30
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /health
      port: 5000
    initialDelaySeconds: 5
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 3

  persistence:
    enabled: true
    storageClass: ""
    accessMode: ReadWriteOnce
    size: 1Gi
    mountPath: /app/data

  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000

  podSecurityContext:
    fsGroup: 1000

  nodeSelector: {}
  tolerations: []
  affinity: {}

# Prometheus (dependency chart values)
prometheus:
  enabled: true
  server:
    persistentVolume:
      enabled: true
      size: 10Gi
    retention: "15d"

# Grafana (dependency chart values)
grafana:
  enabled: true
  adminPassword: "admin123"
  persistence:
    enabled: true
    size: 5Gi

# Loki (dependency chart values) - FIXED FORMAT
loki:
  enabled: true
  persistence:
    enabled: true
    size: 5Gi

  # ✅ Loki chart expects full config override under loki.config as STRING
  loki:
    config: |
      auth_enabled: false
      server:
        http_listen_port: 3100

      ingester:
        lifecycler:
          address: 127.0.0.1
          ring:
            kvstore:
              store: inmemory
            replication_factor: 1

      schema_config:
        configs:
          - from: 2020-10-24
            store: boltdb-shipper
            object_store: filesystem
            schema: v11
            index:
              prefix: index_
              period: 24h

# Promtail (dependency chart values)
promtail:
  enabled: true

# ✅ Avoid CRD failures unless you KNOW operator exists
serviceMonitor:
  enabled: false
  labels:
    app: agro-shop
  interval: 30s
  path: /metrics
  targetPort: 5000

hpa:
  enabled: false

pdb:
  enabled: false

networkPolicy:
  enabled: false
